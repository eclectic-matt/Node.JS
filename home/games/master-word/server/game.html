<!DOCTYPE html>
<html>
	<head>
		<title>Game Lobby</title>
		<style>
		body { margin: 0; padding-bottom: 3rem; font-size: 2em; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
		button { width: 100%; background: #008000; border: none; padding: 0 1rem; margin: 0.25rem; border-radius: 3px; outline: none; color: #fff; font-size: 2em; }
		input { font-size: 3em; }
		img { position: absolute; top: 50px; right: 50px; }
		</style>
	</head>
	<body onload="init()">

		<!-- STEP 1 = ENTER PLAYER NAME -->
		<div id="nameAreaDiv" class="sectionDiv">
			<label for="playerNameInput">Enter your name: </label>
			<input id="playerNameInput" type="text" onchange="playerJoin()"></input>
			<br><br>
			<button onclick="playerJoin()">Join Game</button>
		</div>

		<!-- STEP 2 = WAIT IN LOBBY -->
		<div id="lobbyAreaDiv" class="sectionDiv">
			<h1>Games Lobby</h1>
			<label for="selectedGame">Select a game to play: </label>
			<select id="selectedGame" onchange="openLobby(game)">
				<option value="master-word">Master Word</option>
			</select>
			<br>
			<em>Lobby ID: <span id="lobbyIdSpan"></span></em>
			<br>
			<img id="qrCodeImg" width="100" height="100" src=""/>
			<ul id="playersUL">
				
			</ul>
			<button onclick="startGame()">Start Game</button>
		</div>

		<!-- STEP 3 = PLAY GAME -->
		<div id="gameAreaDiv" class="sectionDiv">
		</div>

		<!-- STEP 4A = BE A SEEKER -->
		<div id="seekerAreaDiv" class="sectionDiv">
		</div>

		<!-- STEP 4B = BE A GUIDE -->
		<div id="guideAreaDiv" class="sectionDiv">
		</div>

		<!-- STEP 5 = GAME ENDS, GO TO STEP 2 -->
		<div id="gameOverAreaDiv" class="sectionDiv">
		</div>

		<script src="/socket.io/socket.io.js"></script>
		<script>
			var socket = io();

			//NEW LOBBY OPENED
			socket.on('new-lobby', function(lobbyId){
				document.getElementById('lobbyIdSpan').innerHTML = lobbyId;
				//UPDATE QR CODE

			});

			//SEND: instruction to open a lobby
			function openLobby(game){
				socket.emit('open-lobby', game);
			}

			function startGame(){
				socket.emit('start-game');
			}

			socket.on('assign-roles', function(roles){
				console.log(roles);
			});

			socket.on('player-join', function(players){
				let playerList = document.getElementById('playersUL');
				playerList.innerHTML = '';
				for (let i = 0; i < players.length; i++){
					let li = document.createElement('li');
					li.key = i;
					if(players[i] === socket.name){
						li.style.fontWeight = 'bolder';
						li.style.color = '#FF0000';
					}
					li.innerHTML = players[i];//.id;
					playerList.appendChild(li);
				}
				//KEEP IMG UPDATED
				game = 'master-word';
				lobbyId = 'un1qu3';
				let img = document.getElementById('qrCodeImg');
				img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/game.html/game/' + game + '/id/' + lobbyId;
			});

			socket.on('setup-round', function(info){
				console.log(info.category, info.word);
			});








			//RECEIVE: lobby id to join game
			socket.on('lobby-open', function(game, lobbyId){
				console.log(game,lobbyId);
				window.location.href = 'game.html/game/' + game + '/id/' + lobbyId;
				//let img = document.createElement('img');
				let img = document.getElementById('qrCodeImg');
				img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/game.html/game/' + game + '/id/' + lobbyId;
				//body.appendChild(img);

				//https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/lobby/game/master-word/id/lobbyId
				//https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/lobby.html/game/master-word/id/un1qu3
			});

			function playerJoin(){
				let nameInput = document.getElementById('playerNameInput');
				let name = nameInput.value;
				socket.name = name;
				socket.emit('player-add', name);
				collapseSections('lobbyAreaDiv');
			}

			function collapseSections(openSection){
				let sections = document.getElementsByClassName('sectionDiv');
				for(let i = 0; i < sections.length; i++){
					if(sections[i].id !== openSection){
						sections[i].style.display = 'none';
					}else{
						sections[i].style.display = 'block';
					}
				}
			}

			function init(){

				//COLLAPSE SECTIONS
				collapseSections('nameAreaDiv');

				const queryString = window.location.pathname.replace('/lobby.html/','');
				const params = queryString.split('/');
				let game = 'Game Error';
				if(params[0] === 'game'){
					game = (params[1]) ? params[1] : 'Game Error!';
					document.getElementById('lobbyGameSpan').innerHTML = game;
				}
				let lobbyId = 'Lobby ID Error';
				if(params[2] === 'id'){
					lobbyId = (params[3]) ? params[3] : 'Lobby ID Error!';
					document.getElementById('lobbyIdSpan').innerHTML = lobbyId;
				}
			}

			//var messages = document.getElementById('messages');
			//var form = document.getElementById('form');
			//var input = document.getElementById('input');

			/*form.addEventListener('submit', function(e) {
				e.preventDefault();
				if (input.value) {
					socket.emit('chat message', input.value);
					input.value = '';
				}
			});*/

			/*socket.on('chat message', function(msg) {
				var item = document.createElement('li');
				item.textContent = msg;
				messages.appendChild(item);
				window.scrollTo(0, document.body.scrollHeight);
			});*/

			
		</script>
	</body>
</html>
