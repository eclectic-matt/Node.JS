<!DOCTYPE html>
<html>
	<head>
		<title>Game Lobby</title>
		<style>
		body { margin: 0; padding-bottom: 3rem; font-size: 2em; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
		button { background: #008000; border: none; padding: 0 1rem; margin: 0.25rem; border-radius: 3px; outline: none; color: #fff; font-size: 2em; }

		</style>
	</head>
	<body onload="init()">

		<div id="playerNameDiv">
			<label for="playerNameInput">Enter your name: </label>
			<input id="playerNameInput" type="text"></input>
			<button onclick="playerJoin()">Join Game</button>
		</div>

		<div id="lobbyAreaDiv">
			<h1>Games Lobby - <span id="lobbyGameSpan"></span></h1>
			<em>Lobby ID: <span id="lobbyIdSpan"></span></em>
			<img id="qrCodeImg" width="100" height="100" src=""/>
			<ul id="playersUL">
				
			</ul>
		</div>
		
		

		<script src="/socket.io/socket.io.js"></script>
		<script>
			var socket = io();

			//SEND: instruction to open a lobby
			function openLobby(game){
				socket.emit('open-lobby', game);
			}

			socket.on('player-join', function(players){
				let playerList = document.getElementById('playersUL');
				playerList.innerHTML = '';
				for (let i = 0; i < players.length; i++){
					let li = document.createElement('li');
					li.key = i;
					li.innerHTML = players[i];//.id;
					playerList.appendChild(li);
				}
				//KEEP IMG UPDATED
				game = 'master-word';
				lobbyId = 'un1qu3';
				let img = document.getElementById('qrCodeImg');
				img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/lobby.html/game/' + game + '/id/' + lobbyId;
			});

			//RECEIVE: lobby id to join game
			socket.on('lobby-open', function(game, lobbyId){
				console.log(game,lobbyId);
				window.location.href = 'lobby.html/game/' + game + '/id/' + lobbyId;
				//let img = document.createElement('img');
				let img = document.getElementById('qrCodeImg');
				img.src = 'https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/lobby.html/game/' + game + '/id/' + lobbyId;
				//body.appendChild(img);

				//https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/lobby/game/master-word/id/lobbyId
				//https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=192.168.0.15:3000/lobby.html/game/master-word/id/un1qu3
			});

			function playerJoin(){
				let nameInput = document.getElementById('playerNameInput');
				let name = nameInput.value;
				socket.emit('player-add', name);
				document.getElementById('lobbyAreaDiv').style.display = 'block';
				document.getElementById('playerNameDiv').style.display = 'none';

			}

			function init(){
				document.getElementById('lobbyAreaDiv').style.display = 'none';
				document.getElementById('playerNameDiv').style.display = 'block';
				const queryString = window.location.pathname.replace('/lobby.html/','');
				const params = queryString.split('/');
				let game = 'Game Error';
				if(params[0] === 'game'){
					game = (params[1]) ? params[1] : 'Game Error!';
					document.getElementById('lobbyGameSpan').innerHTML = game;
				}
				let lobbyId = 'Lobby ID Error';
				if(params[2] === 'id'){
					lobbyId = (params[3]) ? params[3] : 'Lobby ID Error!';
					document.getElementById('lobbyIdSpan').innerHTML = lobbyId;
				}
			}

			//var messages = document.getElementById('messages');
			//var form = document.getElementById('form');
			//var input = document.getElementById('input');

			/*form.addEventListener('submit', function(e) {
				e.preventDefault();
				if (input.value) {
					socket.emit('chat message', input.value);
					input.value = '';
				}
			});*/

			/*socket.on('chat message', function(msg) {
				var item = document.createElement('li');
				item.textContent = msg;
				messages.appendChild(item);
				window.scrollTo(0, document.body.scrollHeight);
			});*/

			
		</script>
	</body>
</html>
